<%- include('../../views/partials/admin/header.ejs') %>

<form  enctype="multipart/form-data" id="editProduct">
  <input type="hidden" id="productId" value="<%= product._id %>">
  <!-- PAGE HEADER -->
  <div class="d-flex align-items-center mb-4 py-2 px-4">
   
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div>
        <h4 class="fw-semibold mb-1">Update Product</h4>
        <p class="text-muted mb-0" style="font-size: 1.2rem;">
          edit product
        </p>
      </div>
      </div>
    <button type="button" id="saveProductBtn" class="btn  ms-auto px-4" style="background-color:#b8c9ae; border:none;">
      <i class="bi bi-check2-circle me-1"></i> Save Product
    </button>
  </div>


  <div class="row py-2 px-4">

    <!-- LEFT SECTION -->
    <div class="col-lg-8 ">

      <!-- BASIC INFORMATION -->
      <div class="bg-white p-4 rounded-3 shadow-sm mb-4">
        <h5 class="fw-semibold mb-3">Basic Information</h5>

        <!-- Product Name -->
        <div class="mb-3">
          <label class="form-label fw-medium">Product Name <span class="text-danger">*</span></label>
          <input type="text" name="productName" class="form-control"
       value="<%= product.productName %>">
          <div id="error-productName" class="text-danger small"></div>
        </div>

        <!-- Description -->
        <div class="mb-3">
          <label class="form-label fw-medium">Description <span class="text-danger">*</span></label>
          <textarea name="description" class="form-control"><%= product.description %></textarea>
            <div id="error-description" class="text-danger small"></div>
        </div>

        <!-- Category + SKU -->
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label fw-medium">Category <span class="text-danger">*</span></label>
            <select name="category" class="form-select" >
               
                <% cat.forEach(c => { %>
                <option value="<%= c.name %>"
                <%= c._id.toString() === product.category._id.toString() ? 'selected' : '' %>>
                <%= c.name %>
                </option>
                 <% }) %>
            </select>
             <div id="error-category" class="text-danger small"></div>
          </div>
        </div>

      </div>

      <!-- PRICING & INVENTORY -->
<div class="bg-white p-4 rounded-3 shadow-sm mb-4">
  <h5 class="fw-semibold mb-3">Pricing and Inventory</h5>
  
  <div id="variantContainer">
    <!-- First variant row -->
    <div class="variant-row mb-3">
        <% product.variants.forEach(v => { %>
      <div class="d-flex gap-3 align-items-start">
        <div class="flex-fill">
          <input type="text" name="variantName[]" value="<%= v.size %>">
          <div class="variant-error text-danger small"></div>
        </div>
        <div class="flex-fill">
          <input type="number" name="variantPrice[]" value="<%= v.regular_price %>">
          <div class="variant-error text-danger small"></div>
        </div>
        <div class="flex-fill">
           <input type="number" name="variantStock[]" value="<%= v.quantity %>">
          <div class="variant-error text-danger small"></div>
        </div>
        <button type="button" class="btn btn-light border removeVariant" style="min-width: 40px;">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      <%})%>
    </div>
  </div>

  <div id="variant-main-error" class="text-danger small mb-2"></div>

  <button type="button" id="addVariantBtn" class="btn btn-outline-secondary rounded-pill mt-2">
    <i class="bi bi-plus-lg me-1"></i> Add Variant
  </button>
</div>
    </div>


    <!-- RIGHT SECTION -->
    <div class="col-lg-4">

      <!-- VISIBILITY -->
      <div class="bg-white p-4 rounded-3 shadow-sm mb-4">
        <h5 class="fw-semibold mb-3">Product Visibility</h5>

        <div class="d-flex justify-content-between align-items-center mb-3">
          <span class="fw-medium">Featured Product</span>
          <div class="form-check form-switch">
            <input class="form-check-input" name="featured" type="checkbox">
          </div>
        </div>

        <label class="fw-medium">Product Status</label>
        <select name="status" class="form-select">
          <option value="Listed">Listed</option>
          <option value="Unlisted">Unlisted</option>
        </select>
      </div>

  
<!-- PRODUCT IMAGES -->
<div class="bg-white p-4 rounded-3 shadow-sm mb-4">
  <h5 class="fw-semibold mb-3">Product Images</h5>
  <p class="text-muted small mb-3">
    <i class="bi bi-info-circle me-1"></i>
    Exactly 3 images required. Check the box to remove an image, then upload new ones.
  </p>

  <div class="border border-2 border-dashed rounded-3 p-4 text-center mb-3" id="uploadArea">
    <i class="bi bi-upload fs-2 text-muted"></i>
    <p class="mb-0 mt-2 text-muted">Click to upload <br> or drag and drop</p>
    <small class="text-muted">PNG, JPG, JPEG (MAX. 2MB per image)</small>

    <input type="file"
           name="images[]"
           id="productImages"
           class="form-control mt-3"
           multiple
           accept="image/png, image/jpeg, image/jpg">
  </div>
  
  <!-- Image Thumbnails Container -->
  <div id="imageThumbnails" class="row g-3">
      <% product.images.forEach(img => { %>
    <div class="col-3">
      <div class="position-relative">
        <img
          src="<%= img.url %>"
          class="img-fluid rounded"
          style="height:120px;object-fit:cover;width:100%;">

        <div class="position-absolute bottom-0 start-0 w-100 p-2"
             style="background:rgba(0,0,0,.6)">
          <label class="text-white d-flex align-items-center mb-0" style="font-size:12px">
            <input
              type="checkbox"
              name="removeImages[]"
              value="<%= img.url %>"
              class="me-2">
            Remove this image
          </label>
        </div>

        <span class="badge bg-primary position-absolute top-0 start-0 m-1">
          Existing
        </span>
      </div>
    </div>
  <% }) %>
  </div>
  
  <div id="imageError" class="text-danger small mt-2"></div>
  <div id="imageCount" class="text-muted small mt-2 fw-semibold"></div>
</div>
    </div>

  </div>

</form>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
<link rel="stylesheet" href="/css/admin/edit.product.css">
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
<script src="/js/admin/product/edit.product.js"></script>



