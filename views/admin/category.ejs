<style>
.category-thead th {
  background-color: #f5f1ea;         /* exact beige header */
  font-size: 16px;                   /* small text like screenshot */
  font-weight: 600;                  /* semi-bold */
  text-transform: none;
  color: #6b6b6b;                    /* muted gray text */
  border-bottom: 1px solid #e9dfd1;  /* light border */
}
.status-pill {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 500;
    text-decoration: none;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
}

.status-active {
    background: #b8c9ae;
    color: white;
}

.status-blocked {
    background: #d9dde4;
    color: #6b6b6b;
}

.toggle-status:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}

.category-card {
  border-radius: 18px;
  overflow: hidden;                  
}

.category-table tbody td {
  background: #ffffff;
}

.offer-toggle {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
}

.offer-toggle input { display: none; }

.offer-slider {
  width: 46px;
  height: 24px;
  border-radius: 999px;
  background-color: #d9dde4;
  position: relative;
  transition: background-color 0.2s ease;
}

.offer-slider::before {
  content: "";
  position: absolute;
  top: 3px;
  left: 3px;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background-color: #ffffff;
  transition: transform 0.2s ease;
}

.offer-toggle input:checked + .offer-slider {
  background-color: #b8c9ae;
}

.offer-toggle input:checked + .offer-slider::before {
  transform: translateX(20px);
}

</style>



<%- include('../../views/partials/admin/header.ejs') %>

<!-- PAGE CONTENT -->
<main class="page-content">

  
  <div class="category-page-wrapper py-1 px-1">

   
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div>
        <h4 class="fw-semibold mb-1">Categories</h4>
        <p class="text-muted mb-0" style="font-size: 1.2rem;">
          Manage product categories
        </p>
      </div>
</div>
    <form method="GET" action="/admin/categories" class="flex-grow-1">
      <div class="bg-white p-3 rounded-3 shadow-sm mb-3 d-flex flex-wrap align-items-center gap-3">

  <!-- Search bar -->
  <div class="flex-grow-1">
    <input 
      type="text" 
      id="categorySearch" 
       name="search"
    class="form-control rounded-pill category-search-input"
    placeholder="Search categories..."
    value="<%= search || '' %>"
    >
  </div></form>

  <!-- Add Category Button -->
  <button type="button"
    class="btn d-inline-flex align-items-center btn-add-category"
    style="background-color:#b8c9ae; border:none;"
    data-bs-toggle="modal"
    data-bs-target="#addCategoryModal">
      <span class="me-2 fw-bold">+</span>
      <span>Add Category</span>
  </button>

</div>
    

        <!-- Add New Category Modal -->
<div class="modal fade" id="addCategoryModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content" style="border-radius:14px; overflow:hidden;">


      <div class="modal-header border-0 px-4 pt-4 pb-2">
        <h5 class="modal-title fw-semibold">Add New Category</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

   
      <form action="/admin/categories/add" method="POST" enctype="multipart/form-data" onsubmit="return handleFormSubmit(event)">
        <div class="modal-body px-4">

          <!-- Category Name -->
          <div class="mb-3">
            <label class="form-label mb-1">Category Name <span class="text-danger">*</span></label>
            <input type="text"
                   name="name"
                   class="form-control"
                   id ="name"
                   >
            <div id="nameError" class="text-danger small mt-1"></div>
          </div>

          <!-- Description -->
          <div class="mb-3">
            <label class="form-label mb-1">Description</label>
            <textarea name="description"
                      class="form-control"
                      rows="3"
                      id="description"
                      placeholder="Brief description of this category"></textarea>
            <div id="descriptionError" class="text-danger small mt-1"></div>
          </div>

          <!-- Category Image -->
          <div class="mb-3">
            <label class="form-label mb-1">Category Image</label>
            <input type="file"
                   name="image"
                   class="form-control"
                   accept="image/*">
            <small class="text-muted">Recommended: square image, good resolution (e.g., 800×800).</small>
            <div id="imageError" class="text-danger small mt-1"></div>
          </div>

        </div>

        <!-- Footer -->
        <div class="modal-footer border-0 px-4 py-3" style="background:#f5eee4;">
          <button type="button"
                  class="btn btn-link text-muted"
                  data-bs-dismiss="modal">
            Cancel
          </button>

          <button type="submit"
                  class="btn px-4"
                  style="background:#b8c9ae; color:#fff; border-radius:999px;">
            Save Category
          </button>
        </div>
      </form>

    </div>
  </div>
</div>

    <!-- White card with table -->
    <div class="card border-0 shadow-sm category-card">
      <div class="table-responsive">
        <table class="table mb-0 align-middle">
            <thead class="category-thead ">
            <tr >
                
                <th class="py-3 ps-4 fw-bold text-muted" >Name</th>
                <th class="py-3 fw-bold text-muted">Description</th>
                <th class="py-3 fw-bold text-muted">Status</th>
                <th class="py-3 fw-bold text-muted">Offer</th>
                <th class="py-3 pe-4 fw-bold text-muted text-end">Actions</th>
            </tr>
            </thead>
            <tbody style="font-size:20px;">

            <% if (!cat || cat.length === 0) { %>
            <tr >
            <td colspan="5" class="text-center text-muted py-4">
                 No categories found
            </td>
            </tr>
            <% } else { %>
                <% for(let i=0 ; i< cat.length; i++){ %>
        <tr id="category-row-<%= cat[i]._id %>">
            <td class="d-flex align-items-center gap-3">
          <img src="<%= cat[i].image %>" class="rounded" width="45">
          <%= cat[i].name %>
        </td>
            
            <td><%= cat[i].description || '-' %></td>  
            
   <!-- Category Status -->
<td>
  <% if (cat[i].is_active) { %>
    <button type="button"
            class="status-pill status-active toggle-status"
            data-id="<%= cat[i]._id %>"
            data-action="inactivate"
            data-name="<%= cat[i].name %>">
      Active
    </button>
  <% } else { %>
    <button type="button"
            class="status-pill status-blocked toggle-status"
            data-id="<%= cat[i]._id %>"
            data-action="activate"
            data-name="<%= cat[i].name %>">
      Inactive
    </button>
  <% } %>
</td>

         <!-- Category Offer -->

    <td>
      <label class="offer-toggle" 
       data-id="<%= cat[i]._id %>" 
       data-offer="<%= cat[i].offerPercent %>"
       data-name="<%= cat[i].name %>">

        <input type="checkbox" <%= cat[i].hasOffer ? "checked" : "" %>>
        <span class="offer-slider"></span>
        <span class="offer-label">
        <%= cat[i].hasOffer ? cat[i].offerPercent + "% off" : "" %>
        </span>
        </label>
        </td>

        
           
<!-- Edit Category  -->
<td class="text-end pe-2">
  <button class="btn btn-link p-0 me-2 text-secondary btn-edit-category"
          data-id="<%= cat[i]._id %>"
          data-name="<%= cat[i].name %>"
          data-description="<%= cat[i].description || '' %>"
          data-image="<%= cat[i].image || '' %>">
    <i class="bi bi-pencil-square fs-4"></i>
  </button>



<button class="btn btn-link p-0 me-2 text-danger btn-delete-category"
        data-id="<%= cat[i]._id %>"
        data-name="<%= cat[i].name %>">
  <i class="bi bi-trash fs-4"></i>
</button>
</td>


    <% } %>

  <% } %>
  
  <!-- Edit Category Modal -->
<div class="modal fade" id="editCategoryModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content" style="border-radius:14px; overflow:hidden;">

      <div class="modal-header border-0 px-4 pt-4 pb-2">
        <h5 class="modal-title fw-semibold">Edit Category</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <form id="editCategoryForm" enctype="multipart/form-data" onsubmit="return handleEditFormSubmit(event)">
        <input type="hidden" id="editCategoryId" name="id">
        
        <div class="modal-body px-4">

          <!-- Category Name -->
          <div class="mb-3">
            <label class="form-label mb-1">Category Name <span class="text-danger">*</span></label>
            <input type="text"
                   name="name"
                   class="form-control"
                   id="editName">
            <div id="editNameError" class="text-danger small mt-1"></div>
          </div>

          <!-- Description -->
          <div class="mb-3">
            <label class="form-label mb-1">Description</label>
            <textarea name="description"
                      class="form-control"
                      rows="3"
                      id="editDescription"
                      placeholder="Brief description of this category"></textarea>
            <div id="editDescriptionError" class="text-danger small mt-1"></div>
          </div>

          <!-- Current Image Preview -->
          <div class="mb-3" id="currentImagePreview" style="display:none;">
            <label class="form-label mb-1">Current Image</label>
            <div>
              <img id="editCurrentImage" src="" alt="Current category image" style="max-width: 150px; max-height: 150px; border-radius: 8px;">
            </div>
          </div>

          <!-- Category Image -->
          <div class="mb-3">
            <label class="form-label mb-1">Category Image (optional)</label>
            <input type="file"
                   name="image"
                   class="form-control"
                   id="editImage"
                   accept="image/*">
            <small class="text-muted">Leave empty to keep current image. Recommended: square image, good resolution (e.g., 800×800).</small>
            <div id="editImageError" class="text-danger small mt-1"></div>
          </div>

        </div>

        <!-- Footer -->
        <div class="modal-footer border-0 px-4 py-3" style="background:#f5eee4;">
          <button type="button"
                  class="btn btn-link text-muted"
                  data-bs-dismiss="modal">
            Cancel
          </button>

          <button type="submit"
                  class="btn px-4"
                  style="background:#b8c9ae; color:#fff; border-radius:999px;">
            Update Category
          </button>
        </div>
      </form>

    </div>
  </div>
</div>


<!-- Status Confirmation Modal -->
<div class="modal fade" id="statusConfirmModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius:14px">

      <div class="modal-header border-0">
        <h5 class="modal-title fw-semibold">Confirm Action</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <p id="statusConfirmText" class="mb-0 text-muted"></p>
      </div>

      <div class="modal-footer border-0">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
          Cancel
        </button>

        <form id="statusConfirmForm">
          <button type="submit"
                  class="btn"
                  style="background:#e5c8b8; color:#2b2b2b;">
            Yes, Confirm
          </button>
        </form>
      </div>

    </div>
  </div>
</div>





                <!-- Category offer modal -->
<div class="modal fade" id="categoryOfferModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content" style="border-radius:14px;">

      <div class="modal-header border-0 px-4 pt-4 pb-2">
        <h5 class="modal-title fw-semibold">Add Category Offer</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body px-4">
        <p id="offerCategoryTitle"></p>

        <label class="form-label">Discount Percentage (%)</label>
        <div class="input-group">
          <input type="number" id="categoryOfferValue" class="form-control" min="0" max="90" value="0">
          <span class="input-group-text">%</span>
        </div>
      </div>

      <div class="modal-footer" style="background:#f5eee4;">
        <button class="btn btn-link text-muted" data-bs-dismiss="modal">Cancel</button>
        <button class="btn" id="saveCategoryOfferBtn" style="background:#b8c9ae;color:white;border-radius:25px;">
          Save Offer
        </button>
      </div>
    </div>
  </div>
</div>


<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius:14px">

      <div class="modal-header border-0">
        <h5 class="modal-title fw-semibold text-danger">Delete Category</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <p id="deleteConfirmText" class="mb-0 text-muted"></p>
      </div>

      <div class="modal-footer border-0">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
          Cancel
        </button>

        <button type="button"
                id="confirmDeleteBtn"
                class="btn btn-danger">
          Yes, Delete
        </button>
      </div>

    </div>
  </div>
</div>

</tbody>

        </table>
        </div>
    </div>
</div>

<%- include('../../views/partials/admin/footer.ejs') %>

</main>        
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  let selectedCategoryId = null;
</script>

<script>
  async function handleFormSubmit(event) {
    event.preventDefault();

    if (!validateForm()) {
      return false; 
    }

    const form = event.target;
    const formData = new FormData(form);

    clearErrorMessages(); 

    try {
      const response = await fetch(form.action, {
        method: form.method,
        body: formData
      });

      const data = await response.json();

      if (!response.ok) {
      
        if (data.error) {
          document.getElementById("nameError").textContent = data.error;
        } else {
          document.getElementById("nameError").textContent =
            "Something went wrong. Please try again.";
        }
        return false;
      }

     
      // close modal and reload page to show new category in table
      const modalEl = document.getElementById('addCategoryModal');
      const modal = bootstrap.Modal.getInstance(modalEl) || new bootstrap.Modal(modalEl);
      modal.hide();

      // Optional: clear form
      form.reset();


      showToast('success', data.message || 'Category added successfully');

      // reload after short delay so user can see toast
      setTimeout(() => {
        window.location.reload();
    }, 1000);

      return true;

    } catch (err) {
      console.error(err);
       showToast('error', 'Something went wrong. Please try again.');
      return false;
    }
  }

  function validateForm() {
    clearErrorMessages();

    const nameInput = document.getElementsByName("name")[0];
    const descriptionInput = document.getElementsByName("description")[0];
    const imageInput = document.getElementsByName("image")[0];
    const name = nameInput.value.trim();
    const description = descriptionInput.value.trim();

    let isValid = true;

    // NAME VALIDATION
    if (!name) {
      document.getElementById("nameError").textContent = "Category name is required.";
      isValid = false;
    } else if (name.length < 3) {
      document.getElementById("nameError").textContent = "Category name should be at least 3 characters.";
      isValid = false;
    } else if (!/^[a-zA-Z\s]+$/.test(name)) {
      document.getElementById("nameError").textContent = "Category name should contain only alphabetic characters.";
      isValid = false;
    }

    // DESCRIPTION VALIDATION
    if (!description) {
      document.getElementById("descriptionError").textContent = "Please write a description.";
      isValid = false;
    } else if (description.length < 5) {
      document.getElementById("descriptionError").textContent = "Description should be at least 5 characters.";
      isValid = false;
    }

    // IMAGE VALIDATION 
    if (!imageInput || imageInput.files.length === 0) {
    document.getElementById("imageError").textContent = "Category image is required.";
    isValid = false;
  } else {
    const file = imageInput.files[0];
    const maxSize = 2 * 1024 * 1024; // 2MB

    if (!file.type.startsWith("image/")) {
      document.getElementById("imageError").textContent = "Please upload a valid image file.";
      isValid = false;
    } else if (file.size > maxSize) {
      document.getElementById("imageError").textContent = "Image size should be less than 2MB.";
      isValid = false;
    }
  }
     return isValid;
  }
  function clearErrorMessages() {
    document.getElementById("nameError").textContent = "";
    document.getElementById("descriptionError").textContent = "";
    document.getElementById("imageError").textContent = "";
  }
</script>
<script>
  const searchInput = document.getElementById('categorySearch');

  searchInput.addEventListener('keydown', function (e) {
    if (e.key === 'Enter') {
      const value = searchInput.value.trim();
      const url = value
        ? `/admin/categories?search=${encodeURIComponent(value)}`
        : `/admin/categories`;

      window.location.href = url;
    }
  });
</script>

<script>
// Open Edit Modal with category data
function openEditModal(categoryId, categoryName, categoryDescription, categoryImage) {
  const modal = new bootstrap.Modal(document.getElementById('editCategoryModal'));
  
  // Populate form fields
  document.getElementById('editCategoryId').value = categoryId;
  document.getElementById('editName').value = categoryName;
  document.getElementById('editDescription').value = categoryDescription || '';
  
  // Show current image if exists
  if (categoryImage) {
    document.getElementById('currentImagePreview').style.display = 'block';
    document.getElementById('editCurrentImage').src = categoryImage;
  } else {
    document.getElementById('currentImagePreview').style.display = 'none';
  }
  
  // Clear any previous errors
  clearEditErrorMessages();
  
  // Reset file input
  document.getElementById('editImage').value = '';
  
  modal.show();
}

// Handle Edit Form Submit
async function handleEditFormSubmit(event) {
  event.preventDefault();

  if (!validateEditForm()) {
    return false;
  }

  const form = event.target;
  const formData = new FormData(form);
  const categoryId = document.getElementById('editCategoryId').value;

  clearEditErrorMessages();

  try {
    const response = await fetch(`/admin/categories/edit/${categoryId}`, {
      method: 'PUT',
      body: formData
    });

    const data = await response.json();

    if (!response.ok) {
      if (data.error) {
        document.getElementById("editNameError").textContent = data.error;
        showToast('error', data.error)
      } else {
        const msg = "Something went wrong. Please try again.";
      document.getElementById("editNameError").textContent = msg;
      showToast('error', msg);
      }
      return false;
    }


    // Close modal
    const modalEl = document.getElementById('editCategoryModal');
    const modal = bootstrap.Modal.getInstance(modalEl);
    modal.hide();


    showToast('success', data.message || 'Category updated');

// reload
    setTimeout(() => {window.location.reload();}, 1000);

    return true;

  } catch (err) {
  console.error(err);
  const msg = "Something went wrong. Please try again.";
  document.getElementById("editNameError").textContent = msg;
  showToast('error', msg);
  return false;
  }
}

// Validate Edit Form
function validateEditForm() {
  clearEditErrorMessages();

  const nameInput = document.getElementById("editName");
  const descriptionInput = document.getElementById("editDescription");
  const imageInput = document.getElementById("editImage");
  const name = nameInput.value.trim();
  const description = descriptionInput.value.trim();

  let isValid = true;

  // NAME VALIDATION
  if (!name) {
    document.getElementById("editNameError").textContent = "Category name is required.";
    isValid = false;
  } else if (name.length < 3) {
    document.getElementById("editNameError").textContent = "Category name should be at least 3 characters.";
    isValid = false;
  } else if (!/^[a-zA-Z\s]+$/.test(name)) {
    document.getElementById("editNameError").textContent = "Category name should contain only alphabetic characters.";
    isValid = false;
  }

  // DESCRIPTION VALIDATION
  if (!description) {
    document.getElementById("editDescriptionError").textContent = "Please write a description.";
    isValid = false;
  } else if (description.length < 5) {
    document.getElementById("editDescriptionError").textContent = "Description should be at least 5 characters.";
    isValid = false;
  }

  // IMAGE VALIDATION (only if a new file is selected)
  if (imageInput && imageInput.files.length > 0) {
    const file = imageInput.files[0];
    const maxSize = 2 * 1024 * 1024; // 2MB

    if (!file.type.startsWith("image/")) {
      document.getElementById("editImageError").textContent = "Please upload a valid image file.";
      isValid = false;
    } else if (file.size > maxSize) {
      document.getElementById("editImageError").textContent = "Image size should be less than 2MB.";
      isValid = false;
    }
  }

  return isValid;
}

// Clear Edit Error Messages
function clearEditErrorMessages() {
  document.getElementById("editNameError").textContent = "";
  document.getElementById("editDescriptionError").textContent = "";
  document.getElementById("editImageError").textContent = "";
}

// Attach click handlers to edit buttons
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.btn-edit-category').forEach(button => {
    button.addEventListener('click', function() {
      const categoryId = this.dataset.id;
      const categoryName = this.dataset.name;
      const categoryDescription = this.dataset.description;
      const categoryImage = this.dataset.image;
      
      openEditModal(categoryId, categoryName, categoryDescription, categoryImage);
    });
  });
});
</script>

<script>


// EVENT: User toggles offer checkbox
document.querySelectorAll(".offer-toggle input").forEach(checkbox => {
  checkbox.addEventListener("change", function () {
    const wrapper = this.closest(".offer-toggle");
    const id = wrapper.dataset.id;
    const name = wrapper.dataset.name;
    const currentOffer = wrapper.dataset.offer || 0;

    if (this.checked) {
     
     const modalEl = document.getElementById("categoryOfferModal");
      modalEl.dataset.id = id;

    document.getElementById("offerCategoryTitle").textContent =
    `Add offer for: ${name}`;
  document.getElementById("categoryOfferValue").value = currentOffer;

 
  const modal = new bootstrap.Modal(modalEl);

 
  const checkbox = this;

  const onHide = () => {
    
    const offer = Number(wrapper.dataset.offer || 0);
    if (offer === 0) {
      checkbox.checked = false;
    }
    modalEl.removeEventListener("hidden.bs.modal", onHide);
  };

  modalEl.addEventListener("hidden.bs.modal", onHide);
  modal.show();

      
    } else {
      //TOGGLE OFF -Remove offer immediately
      removeOffer(id, wrapper, this);
    }
  });
});


//Toggle OFF logic
async function removeOffer(categoryId, wrapper, checkbox) {
  try {
    const res = await fetch(`/admin/categories/${categoryId}/offer`, {
      method: "PATCH",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ percent: 0 })  // reset everything
    });

    const data = await res.json();

    if (!data.success) {
      showToast('error', data.message || 'Failed to remove offer');
      checkbox.checked = true; // revert on failure
      return;
    }

    wrapper.querySelector(".offer-label").textContent = "";
    wrapper.dataset.offer = 0;

    showToast('success', 'Category offer removed');

  } catch (err) {
    console.error(err);
    showToast('error', 'Error removing offer');
    checkbox.checked = true;
  }
}


// SAVE OFFER BUTTON
document.getElementById("saveCategoryOfferBtn").addEventListener("click", async () => {
  const percent = Number(document.getElementById("categoryOfferValue").value) || 0;
  const modalEl = document.getElementById("categoryOfferModal");
  const categoryId = modalEl.dataset.id;   
 

  if (!categoryId) {
    showToast('error',"Category not selected");
    return;
  }

  try {
    const res = await fetch(`/admin/categories/${categoryId}/offer`, {
      method: "PATCH",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ percent })
    });

    const data = await res.json();

    if (!data.success) {
      showToast('error', data.message || 'Server error');
      return;
    }

    const msg = percent > 0 ? 'Offer added to category ' : 'Offer removed from category';
    showToast('success', msg);

    bootstrap.Modal.getInstance(modalEl).hide();

    setTimeout(() => {
    window.location.reload();}, 1000);
  } catch (err) {
    console.error("Offer save error:", err);
    showToast('error', 'Server error');
  }
});

</script>


<script>
  let selectedAction = null;
// Open confirmation modal
document.querySelectorAll('.toggle-status').forEach(button => {
  button.addEventListener('click', function () {

    selectedCategoryId = this.dataset.id;
    selectedAction = this.dataset.action;
    const name = this.dataset.name;

    document.getElementById('statusConfirmText').textContent =
      selectedAction === "inactivate"
        ? `Are you sure you want to deactivate the category "${name}"?`
        : `Are you sure you want to activate the category "${name}"?`;

    new bootstrap.Modal(
      document.getElementById('statusConfirmModal')
    ).show();
  });
});

// Confirm action
document.getElementById('statusConfirmForm').addEventListener('submit', async function (e) {
  e.preventDefault();

  if (!selectedCategoryId || !selectedAction) return;

  try {
    const res = await fetch(
      `/admin/categories/${selectedCategoryId}/${selectedAction}`,
      { method: 'PATCH' }
    );

    const data = await res.json();

    if (!res.ok || !data.success) {
      showToast('error', data.message || 'Failed to update status');
      return;
    }

    bootstrap.Modal.getInstance(
      document.getElementById('statusConfirmModal')
    ).hide();

    const msg = selectedAction === 'inactivate'
  ? 'Category deactivated'
  : 'Category activated';

showToast('success', msg);

setTimeout(() => {
  window.location.reload();
}, 1000);

  } catch (err) {
    console.error(err);
  showToast('error', 'Network error. Please try again.');
  }
});
</script>
<script>
let deleteCategoryId = null;

// Open delete modal
document.querySelectorAll('.btn-delete-category').forEach(btn => {
  btn.addEventListener('click', function () {
    deleteCategoryId = this.dataset.id;
    const name = this.dataset.name;

    document.getElementById('deleteConfirmText').textContent =
      `Are you sure you want to permanently delete the category "${name}"? This action cannot be undone.`;

    new bootstrap.Modal(
      document.getElementById('deleteConfirmModal')
    ).show();
  });
});

// Confirm delete
document.getElementById('confirmDeleteBtn').addEventListener('click', async function () {
  if (!deleteCategoryId) return;

  try {
    const res = await fetch(`/admin/categories/${deleteCategoryId}`, {
      method: 'DELETE'
    });

    const data = await res.json();

    if (!res.ok || !data.success) {
      showToast('Failed to delete category');
      
      return;
    }

    bootstrap.Modal.getInstance(
      document.getElementById('deleteConfirmModal')
    ).hide();

  showToast('success', 'Category deleted');

setTimeout(() => {
  window.location.reload();
}, 1000);

  } catch (err) {
    console.error(err);
    showToast('Network error. Please try again.');
  }
});
</script>





